<!DOCTYPE html>
<html lang="hy">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‘º÷Ä’ø’•’Ω P2P PRO</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        :root { --bg: #0f172a; --card: #1e293b; --accent: #38bdf8; --kill: #ef4444; --text: #f8fafc; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); text-align: center; padding: 20px; margin: 0; }
        .container { max-width: 450px; margin: auto; background: var(--card); padding: 25px; border-radius: 24px; box-shadow: 0 20px 50px rgba(0,0,0,0.5); }
        input, select { width: 100%; padding: 12px; margin: 10px 0; border-radius: 12px; border: 1px solid #334155; background: #0f172a; color: white; box-sizing: border-box; font-size: 16px; }
        button { width: 100%; padding: 14px; margin: 8px 0; border-radius: 12px; border: none; cursor: pointer; font-weight: bold; transition: 0.3s; font-size: 16px; }
        .btn-main { background: var(--accent); color: #0f172a; }
        .btn-sec { background: #334155; color: white; }
        .btn-kick { width: auto; padding: 5px 10px; background: var(--kill); font-size: 12px; margin-left: 5px; }
        #role-box { font-size: 1.4rem; color: #fbbf24; border: 2px dashed #334155; padding: 20px; margin: 20px 0; border-radius: 16px; background: rgba(0,0,0,0.2); }
        .player-item, .word-item { display: flex; justify-content: space-between; align-items: center; background: #334155; padding: 10px; margin: 6px 0; border-radius: 10px; font-size: 14px; }
        .badge { background: var(--accent); color: #0f172a; padding: 2px 8px; border-radius: 5px; font-size: 12px; margin-bottom: 10px; display: inline-block; }
        #word-editor { display: none; background: #0f172a; padding: 15px; border-radius: 15px; margin-top: 15px; max-height: 200px; overflow-y: auto; text-align: left; }
    </style>
</head>
<body>

<div class="container">
    <h1>üïµÔ∏è ‘º’ê’è‘µ’ç</h1>
    
    <div id="view-setup">
        <input type="text" id="name-input" placeholder="’î’∏ ’°’∂’∏÷Ç’∂’®">
        <button class="btn-main" onclick="initHost()">’ç’ø’•’≤’Æ’•’¨ ’∂’∏÷Ä ’Ω’•’∂’µ’°’Ø</button>
        <div style="margin: 15px 0; opacity: 0.5;">‘ø‘±’Ñ</div>
        <input type="text" id="join-id-input" placeholder="’Ñ’∏÷Ç’ø÷Ñ’°’£÷Ä’•÷Ñ 6-’∂’´’∑’°’∂’∏÷Å ID-’∂">
        <button class="btn-sec" onclick="initClient()">’Ñ’∏÷Ç’ø÷Ñ ’£’∏÷Ä’Æ’•’¨ ID-’∏’æ</button>
    </div>

    <div id="view-lobby" style="display:none;">
        <div id="role-box">’ç’∫’°’Ω’∏÷Ç’¥ ’•’∂÷Ñ ’Ω’Ø’¶’¢’´’∂...</div>
        <div id="topic-display" class="badge">‘π’•’¥’°. ’é’°’µ÷Ä’•÷Ä</div>

        <div id="host-controls" style="display:none;">
            <select id="topic-select" onchange="changeTopic()">
                <option value="places">’é’°’µ÷Ä’•÷Ä</option>
                <option value="countries">‘µ÷Ä’Ø÷Ä’∂’•÷Ä</option>
                <option value="people">’Ñ’°÷Ä’§’´’Ø</option>
                <option value="items">‘±’º’°÷Ä’Ø’°’∂’•÷Ä</option>
                <option value="adult">18+</option>
            </select>
            <button class="btn-sec" onclick="toggleWordEditor()">üìù ‘Ω’¥’¢’°’£÷Ä’•’¨ ’¢’°’º’•÷Ä’®</button>
            <div id="word-editor" style="display:none;"></div>
            
            <button class="btn-main" onclick="startGame()">‘≤‘±‘∫‘±’Ü‘µ‘º ‘¥‘µ’ê‘µ’ê‘∏</button>
            <button class="btn-sec" onclick="resetGame()">‘±’é‘±’ê’è‘µ‘º ‘Ω‘±’Ç‘∏</button>
        </div>

        <p id="room-id-display" onclick="copyId()" style="cursor:pointer; color: var(--accent); font-weight: bold; font-size: 1.2rem;"></p>
        <div id="player-list"></div>
    </div>
</div>

        <script>
    const database = {
        places: ["‘¥’∫÷Ä’∏÷Å", "’Ä’´’æ’°’∂’§’°’∂’∏÷Å", "’è’´’•’¶’•÷Ä÷Ñ", "’ç’∏÷Ç’¶’°’∂’°’æ", "‘ø÷Ä’Ø’•’Ω", "‘π’°’∂’£’°÷Ä’°’∂", "’å’•’Ω’ø’∏÷Ä’°’∂", "’ï’§’°’∂’°’æ’°’Ø’°’µ’°’∂", "‘≤’°’∂’°’Ø","‘±÷Ä’°’¥’´ ’ø’∏÷Ç’∂","‘ø’°÷Ä’•’∂’´ ’ø’∏÷Ç’∂","‘¥’∏’§’∏ ’∫’´÷Å÷Å’°","’Ç’∏÷Ç’Ø’°’Ω’µ’°’∂’´ ’ç’°’§","’ä’¨’•’µ’Ω’ø’•’µ’∑’∂’∏÷Å","‘ø’∏’¥’∫’∂’∏÷Å"],
        countries: ["’Ä’°’µ’°’Ω’ø’°’∂", "’å’∏÷Ç’Ω’°’Ω’ø’°’∂", "‘±’Ñ’Ü", "’É’°’∫’∏’∂’´’°", "‘µ’£’´’∫’ø’∏’Ω", "’ñ÷Ä’°’∂’Ω’´’°", "‘ª’ø’°’¨’´’°", "‘∑’¥’´÷Ä’°’ø’∂’•÷Ä", "’â’´’∂’°’Ω’ø’°’∂"],
        people: ["’Ü’´’Ø’∏’¨", "‘≤’™’´’∑’Ø", "’à’Ω’ø’´’Ø’°’∂", "‘±÷Ä’°’¥", "‘ø’°÷Ä’•’∂", "’Ü’°÷Ä’•’Ø", "’ç÷á’°’Ø", "’é’°÷Ä’§’°’∂ ’Ç’∏÷Ç’Ø’°’Ω’µ’°’∂"],
        items: ["’Ä’•’º’°’≠’∏’Ω", "’ì’∏’≤", "‘π’°’æ’°", "‘∑’¨’•’Ø’ø÷Ä’°’Ø’°’∂ ’Ω’≤’∏÷Å", "’Ä’°’µ’•’¨’´", "’Ñ’°’∂÷Ä’°’§’´’ø’°’Ø","’Ä’°’¥’°’Ø’°÷Ä’£’´’π"],
        adult: ["‘≤’∏’¶’∂’∏÷Å", "‘≥’´’∑’•÷Ä’°’µ’´’∂ ’°’Ø’∏÷Ç’¥’¢", "’ç’ø÷Ä’´’∫’ø’´’¶-’¢’°÷Ä", "‘ø’°’¶’´’∂’∏", "’é’´’∑’Ø’´ ‘±’∂’∂’°’µ’´ ’ø’∏÷Ç’∂", "’Ü’°÷Ä’•’Ø’´ ’®’∂’Ø’•÷Ä’∂’•÷Ä’´ ’£’°’º’°’™","23 ’§’∫÷Ä’∏÷Å’´ ’¶’∏÷Ç’£’°÷Ä’°’∂","’Ü’°÷Ä’•’Ø’´ ’π’°’Ω’ø","‘±÷Ä’°’¥’´ ’¶’∏’¥’¢’´ ’°’∫’°’Ø’°’¨’´’∫’Ω’´’Ω’´ ’ø’∏÷Ç’∂","PornHub","‘≤’∏’¶","‘π’°’©’°’µ’´ ’∞’°’¥’•÷Ä’£","‘∂’´’∂’Ø’∏’¥","‘∑’∫’∑’ø’•’µ’∂’´ ’Ø’≤’¶’´"]
    };

    let peer = null, connMap = {}, myName = "", isHost = false, currentTopic = "places";

    // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –æ–±—Ö–æ–¥–∞ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ (STUN + TURN)
    const peerConfig = {
        config: {
            iceServers: [
                { urls: 'stun:stun.l.google.com:19302' },
                { urls: 'stun:global.stun.twilio.com:3478' },
                // –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ TURN —Å–µ—Ä–≤–µ—Ä—ã –æ—Ç OpenRelay
                {
                    urls: 'turn:openrelay.metered.ca:443',
                    username: 'openrelayproject',
                    credential: 'openrelayproject'
                },
                {
                    urls: 'turn:openrelay.metered.ca:80',
                    username: 'openrelayproject',
                    credential: 'openrelayproject'
                }
            ]
        }
    };

    function generateShortId() { return Math.random().toString(36).substring(2, 8).toUpperCase(); }

    function initHost() {
        myName = document.getElementById('name-input').value || "‘±’§’¥’´’∂";
        peer = new Peer(generateShortId(), peerConfig);
        
        peer.on('open', (id) => {
            isHost = true;
            document.getElementById('room-id-display').innerText = "ID. " + id;
            showLobby(); updatePlayerList(); renderWordEditor();
        });

        peer.on('error', (err) => { 
            console.error(err);
            if(err.type === 'unavailable-id') initHost(); 
            else alert("–°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞: " + err.type); 
        });

        peer.on('connection', (conn) => {
            conn.on('open', () => {
                conn.on('data', (data) => {
                    if (data.type === 'join') {
                        connMap[conn.peer] = { conn: conn, name: data.name };
                        updatePlayerList();
                        broadcast({ type: 'list', list: getNames(), topic: getTopicName(currentTopic) });
                    }
                });
            });
        });
    }

    function initClient() {
        myName = document.getElementById('name-input').value || "‘Ω’°’≤’°÷Å’∏’≤";
        const targetId = document.getElementById('join-id-input').value.toUpperCase();
        if (!targetId) return alert("–í–≤–µ–¥–∏—Ç–µ ID!");
        
        peer = new Peer(peerConfig);
        
        peer.on('open', () => {
            const conn = peer.connect(targetId, { reliable: true });
            conn.on('open', () => { 
                conn.send({ type: 'join', name: myName }); 
                showLobby(); 
            });
            conn.on('data', (data) => {
                if (data.type === 'role') document.getElementById('role-box').innerText = data.val;
                if (data.type === 'list') { updateClientList(data.list); document.getElementById('topic-display').innerText = "‘π’•’¥’°. " + data.topic; }
                if (data.type === 'reset') document.getElementById('role-box').innerText = "’ç’∫’°’Ω’∏÷Ç’¥...";
                if (data.type === 'kick') { alert("’Ä’•’º’°÷Å’æ’°’Æ ’•÷Ñ"); location.reload(); }
            });
            conn.on('error', (err) => alert("–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: " + err));
        });
    }

    function toggleWordEditor() {
        const editor = document.getElementById('word-editor');
        editor.style.display = editor.style.display === 'none' ? 'block' : 'none';
    }

    function renderWordEditor() {
        const editor = document.getElementById('word-editor');
        const words = database[currentTopic];
        editor.innerHTML = `<b>${getTopicName(currentTopic)} ’¢’°’º’•÷Ä’®:</b><br>`;
        words.forEach((word, index) => {
            editor.innerHTML += `
                <div class="word-item">
                    ${word} 
                    <button class="btn-kick" onclick="deleteWord(${index})">üóëÔ∏è</button>
                </div>`;
        });
    }

    function deleteWord(index) {
        if (database[currentTopic].length <= 1) return alert("’â’´ ’Ø’°÷Ä’•’¨’´ ’ª’∂’ª’•’¨ ’æ’•÷Ä’ª’´’∂ ’¢’°’º’®:");
        database[currentTopic].splice(index, 1);
        renderWordEditor();
    }

    function changeTopic() {
        currentTopic = document.getElementById('topic-select').value;
        renderWordEditor();
        const tName = getTopicName(currentTopic);
        document.getElementById('topic-display').innerText = "‘π’•’¥’°. " + tName;
        broadcast({ type: 'list', list: getNames(), topic: tName });
    }

    function startGame() {
        const pool = database[currentTopic];
        const word = pool[Math.floor(Math.random() * pool.length)];
        const ids = Object.keys(connMap);
        const spyIdx = Math.floor(Math.random() * (ids.length + 1));
        const myRole = (spyIdx === ids.length) ? "‘¥’∏÷Ç ‘º’ê’è‘µ’ç ’•’Ω: üïµÔ∏è" : "‘≤’°’º’®. " + word;
        document.getElementById('role-box').innerText = myRole;
        ids.forEach((id, i) => {
            connMap[id].conn.send({ type: 'role', val: (i === spyIdx ? "‘¥’∏÷Ç ‘º’ê’è‘µ’ç ’•’Ω: üïµÔ∏è" : "‘≤’°’º’®. " + word) });});
    }

    function showLobby() {
        document.getElementById('view-setup').style.display = 'none';
        document.getElementById('view-lobby').style.display = 'block';
        if (isHost) document.getElementById('host-controls').style.display = 'block';
    }

    function updatePlayerList() {
        const listDiv = document.getElementById('player-list');
        listDiv.innerHTML = `<div class="player-item"><b>üëë ${myName}</b></div>`;
        for (let id in connMap) listDiv.innerHTML += `<div class="player-item">${connMap[id].name} <button class="btn-kick" onclick="kick('${id}')">‚ùå</button></div>`;
    }

    function updateClientList(list) {
        document.getElementById('player-list').innerHTML = list.map((n, i) => `<div class="player-item">${i===0?'üëë ':''}${n}</div>`).join('');
    }

    function kick(id) {
        connMap[id].conn.send({type: 'kick'});
        connMap[id].conn.close(); delete connMap[id];
        updatePlayerList(); broadcast({ type: 'list', list: getNames(), topic: getTopicName(currentTopic) });
    }

    function broadcast(data) { Object.values(connMap).forEach(p => p.conn.send(data)); }
    function resetGame() { document.getElementById('role-box').innerText = "’ç’∫’°’Ω’∏÷Ç’¥..."; broadcast({ type: 'reset' }); }
    function getNames() { return [myName, ...Object.values(connMap).map(c => c.name)]; }
    function getTopicName(v) { 
        const sel = document.getElementById('topic-select');
        return sel.options[sel.selectedIndex].text;
    }
    function copyId() {
        const idText = document.getElementById('room-id-display').innerText;
        const id = idText.includes(". ") ? idText.split(". ")[1] : idText;
        navigator.clipboard.writeText(id).then(() => alert("ID " + id + " ’∫’°’ø’≥’•’∂’æ’•÷Å:"));
    }
                </script>
</body>
</html>
